//!wrt $BSPEC:{"icn":"objects/tools","cpr":"Copyright (C) Windows 96 Team 2023.","dsc":"System Flags","frn":"System Flags","ver":1,"ssy":"gui"}

const{DialogCreator:DialogCreator,Theme:Theme,MenuBar:MenuBar}=w96.ui,{ListBox:ListBox}=w96.ui.components,{has:hasFlag,set:setFlag,clear:clearFlags}=w96.sys.flags,{getReleaseChannel:getReleaseChannel}=w96.sys.rel,systemFlags=[{displayName:"Disable anti-virus service",name:"av_svc_disabled",description:"Disable the anti-virus service.",args:[]},{displayName:"Disable analytics and tracking",name:"disable_analytics",description:"Disables the analytics script ran on startup.",args:[]},{displayName:"Simulate missing IndexedDB",name:"simulate_missing_idb",description:"Removes indexedDb from the session to simulate a missing storage backend.",args:[]},{displayName:"Disable WebAssembly",name:"simulate_no_wasm",description:"Removes WebAssembly from the current session.",args:[]},{displayName:"Do not mount W:/",name:"sys_ignore_mount",description:"Does not mount the W:/ system drive upon boot.",args:[]},{displayName:"Disable update notifications",name:"no_update_notifs",description:"Disables the system update notification.",args:[]},{displayName:"Disable boot scripts",name:"no_boot_scripts",description:"Disables the processing of scripts in c:/system/boot during startup.",args:[]},{displayName:"Disable desktop icons",name:"no_desktop_icons",description:"Stops desktop icons from appearing.",args:[]},{displayName:"Hide build info",name:"no_build_info",description:"Hides the build info from the desktop.",args:[]},{displayName:"Force pixelated image rendering",name:"force_pixel_render",description:"Forces the browser to render all images pixelated.",args:[]},{displayName:"Disable fast booting",name:"no_fastboot",description:"Enables kernel debug timers. These are disabled by default.",args:[]},{displayName:"Display exceptions",name:"exclaim_exceptions",description:"Shows error dialogs for exceptions that occur during your session.",args:[]},{displayName:"Do not load previous desktop icon positions",name:"no_icon_positioning",description:"Prevents desktop icons from loading in their last placed positions.",args:[]},{displayName:"Disable new bootscreen",name:"disable_new_bootscreen",description:"Disables the beta version of the startup screen",args:[]},{displayName:"Disable window compositing",name:"disable_wcomp",description:"Disables window compositing (may break some themes).",args:[]},{displayName:"Disable eastereggs",name:"disable_easter_eggs",description:"Disables eastereggs and other jokes.",args:[]},{displayName:"Disable system log",name:"disable_syslog",description:"Disables the system event log (not recommended).",args:[]}];class FlagsApplication extends WApplication{constructor(){super()}async main(e){super.main(e),"undefined"!=typeof BatteryManager&&systemFlags.push({displayName:"Disable battery monitoring",name:"disable_battery_api",description:"Disables the battery monitoring service.",args:[]}),"staging"!=getReleaseChannel()&&"development"!=getReleaseChannel()||systemFlags.push({displayName:'Disable "Comments?" button',name:"disable_comments_btn",description:"Disables the Comments button on all windows.",args:[]});const s=this.createWindow({title:"System Flags",icon:await Theme.getIconUrl("objects/tools","16x16"),body:`\n            <div class="appbar"></div>\n            <div class="container">\n                <div class="list-box"></div>\n                <div class="buttons">\n                    <button class="w96-button toggle" disabled>Enable</button>\n                    <button class="w96-button clear">Clear All</button>\n                    <button class="w96-button reboot">Reboot</button>\n                </div>\n            </div>\n            <footer class="w96-footer">\n                <div class="cell">\n                    ${systemFlags.length} available flags\n                </div>\n            </footer>`,bodyClass:"wflags-app",center:!0,initialWidth:500,height:340,taskbar:!0},!0),a=new MenuBar;a.addRoot("File",[{type:"normal",label:"Exit",onclick:()=>this.terminate()}]),a.addRoot("Help",[{type:"normal",label:"About",onclick:()=>DialogCreator.create({title:"About",icon:"info",body:'<span class="bold-noaa">System Flags 1.0.</span><br><br>Copyright (C) windows96.net 2023.'})}]);const t=s.getBodyContainer();t.querySelector(".appbar").replaceWith(a.getMenuDiv());const i=new ListBox;for(let e of systemFlags){const s=i.addItem(e.displayName,e.name);hasFlag(e.name)&&s.classList.add("enabled"),s.innerHTML=`\n                <span class="bold-noaa">${e.displayName} <i style="opacity: 50%">[${e.name}]</i></span><br>\n                ${e.description}\n            `,s.addEventListener("dblclick",(()=>{t.querySelector("button.toggle").click()})),s.addEventListener("click",(()=>{const a=t.querySelector("button.toggle");a.disabled=!1;let i=()=>{s.classList.remove("enabled"),a.innerText="Enable",hasFlag(e.name)&&setFlag(e.name,!1),a.onclick=n},n=()=>{s.classList.add("enabled"),a.innerText="Disable",hasFlag(e.name)||setFlag(e.name),a.onclick=i};s.classList.contains("enabled")?(a.innerText="Disable",a.onclick=i):(a.innerText="Enable",a.onclick=n)}))}const n=i.getElement();t.querySelector(".list-box").replaceWith(n),t.querySelector("button.reboot").addEventListener("click",(()=>document.location.reload())),t.querySelector("button.clear").addEventListener("click",(()=>{n.querySelectorAll(".item").forEach((e=>e.classList.remove("enabled"))),clearFlags()})),s.show(),"true"!==localStorage.getItem("flags_first_time_done")&&(DialogCreator.create({title:"Warning",icon:"warning",body:'<span class="bold-noaa">This tool is intended for developers or for troubleshooting.</span><br>Changing any of these options may cause instability or a loss of data.<br>We will not provide any support for systems with flags enabled.'}),localStorage.setItem("flags_first_time_done","true"))}}

return await WApplication.execAsync(new FlagsApplication(), this.boxedEnv.args, this);